# 11장. 시스템
#### 시스템 제작과 시스템 사용을 분리하라
- 제작(construction)과 사용(use)은 아주 다르다.
- 소프트웨어 시스템은 (애플리케이션 객체를 제작하고 의존성을 서로 연결하는) 준비과정과 (준비 과정 이후에 이어지는) 런타입 로직을 분리해야 한다.
- 관심사 분리는 우리 분야에서 가장 오래되고 가장 중요한 설계 기법 중 하나이다.
~~~java
  public Service getService() {
    if (service == null) 
      service = new MyServiceImpl(...);
    return service;
  }
~~~
- 위 코드는 시작 단계라는 관심사를 분리하지 않고, 런타임 로직과 마구 뒤섞인 예이다.
- 초기화 지연(Lazy Initialization) 혹은 계산 지연(Lazy Evaluation) 기법이라 부른다.
  - 장점 1 > 실제 필요할 때까지 객체 생성 x -> 불필요한 부하가 없음 -> application 시작 시간이 빨라짐
  - 장점 2 > 어떤 경우에도 null 포인터를 반환하지 않음.
  - 단점 1 > 생성자 인수에 명시적으로 의존함. -> 해결하지 못하면 컴파일이 안됨
  - 단점 2 > 테스트 시, 테스트 전용 객체를 service 필드에 할당해야 함.
  - 단점 3 > 일반 런타임 로직에 객체 생성 로직을 섞어놓은 탓에 모든 실행 경로도 테스트해야 함 -> 단일 책임 원칙을 깬다!!!
- 체계적이고 탄탄한 시스템을 만들고 싶다면 설정 논리를 일반 실행 논리와 분리하여 모듈성을 높여야 함
- Main 분리
- 팩토리(abstract factory 패턴)
- 의존성 주입(DI) - 제어 역전 기법을 의존성 관리에 적용한 메커니즘
  - 제어 역전 : 한 객체가 맡은 보조 책임을 새로운 객체에게 전적으로 떠넘김
  - 새로운 객체는 넘겨받은 책임만 맡으므로 단일 책임 원칙을 지키게 된다.
  - 클래스가 의존성을 해결하려 시도하지 않는다.
  - DI 컨테이너는 필요한 객체의 인스턴스를 만든 후 생성자 인수나 설정자 메서드를 사용해 의존성을 설정
#### 확장
- 횡단 관심사
  - 영속성, 보안, 트랜잭션을 처리하는 방식 -> AOP => 대상 코드에 영향
#### 자바 프록시
- 개별 객체나 클래스에서 메서드 호출을 감싸는 경우
#### 순수 자바 AOP 프레임워크
- 스프링은 비즈니스 논리를 POJO로 구현
#### AspectJ 관점
- 관심사를 관점으로 분리하는 가장 강력한 도구는 AspectJ 언어이다.
#### 테스트 주도 시스템 아키텍처 구축
- 코드 수준에서 아키텍처 관심사를 분리할 수 있다면, 진정한 테스트 주도 아키텍처가 가능해진다.
#### 의사 결정을 최적화하라
- 관심사를 모듈로 분리한 POJO 시스템은 기민함을 제공.
#### 명백한 가치가 있을 때 표준을 현명하게 사용하라
#### 시스템은 도메인 특화 언어가 필요하다
- DSL : 간단한 스크립트 언어나 표준 언어로 구현한 API
- DSL은 추상화 수준을 코드 관용구나 디자인 패턴 이상으로 끌어올린다.
#### 결론
- 시스템 역시 깨끗해야 한다
- 시스템을 설계하든 개별 모듈을 설계하든, 실제로 돌아가는 가장 단순한 수단을 사용해야 한다는 사실을 명심하자