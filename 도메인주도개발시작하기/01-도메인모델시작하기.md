# 1장. 도메인 모델 시작하기
## 1.1 도메인이란?
- "온라인 서점" : 개발자의 입장에서 상품조회, 구매, 결제, 배송 추적 등의 기능을 제공할 줄 알아야 한다.
- 이 때 온라인 서점은 소프트웨어로 해결하고자 하는 문제의 영역. 즉 도메인이 된다.
- 한 도메인은 다시 하위 도메인으로 나눌 수 있음.

<img src="/Users/jayo/Library/Application Support/typora-user-images/image-20220612153944142.png" alt="image-20220612153944142" style="zoom:50%;" />

## 1.2 도메인 전문가와 개발자 간 지식 공유

- 온라인 홍보, 정산, 배송 등에는 각 분야의 전문가가 존재함.
- 이러한 전문가들은 해당 도메인에 대한 지식과 경험을 바탕으로 본인들이 원하는 기능 개발을 요구함.
- 개발자는 이러 요구사항을 분석하고, 설계하여 코드를 작성하고 배포한다.
- 요구사항을 제대로 이해하지 못하면, 엉뚱한 기능을 만들게 되며 이에 요구사항을 올바르게 이해하는 것이 중요하다.

- Garbage in, garbage out. 잘못된 값을 넣으면, 잘못된 결과가 나온다.
- 전문가나 관련자가 요구한 내용이 반드시 올바른 것은 아니며, 정확하게 표현하지 못 할 수도 있다.
- 이에 전문가와의 대화를 통해 정말로 원하는 것을 찾는 일이 필요하다.

## 1.3 도메인 모델

- 도메인 모델 : 특정 도메인을 개념적으로 표현한 것
- <img src="/Users/jayo/Library/Application Support/typora-user-images/image-20220612155914736.png" alt="image-20220612155914736" style="zoom:50%;" />
- 도메인 모델을 사용하면 여러 관계자들이 동일한 모습으로 도메인을 이해하고 도메인 지식을 이해하는데 도움이 됨.
- <img src="/Users/jayo/Library/Application Support/typora-user-images/image-20220612160641943.png" alt="image-20220612160641943" style="zoom:50%;" />

- 물론 위처럼 UML 표기법만 사용해야 하는 것은 아님.

## 1.4 도메인 모델 패턴

- 일반적인 애플리케이션의 아키텍처는 아래처럼 4개의 영역으로 나눠진다

<img src="/Users/jayo/Library/Application Support/typora-user-images/image-20220612161619606.png" alt="image-20220612161619606" style="zoom:50%;" />

| 영역                          | 설명                                                         |
| ----------------------------- | :----------------------------------------------------------- |
| 사용자 인터페이스(UI) or 표현 | 사용자의 요청을 처리하고 사용자에게 정보를 보여준다. 여기서 사용자는 소프트웨어를 사용하는 사람뿐만 아니라 외부 시스템일 수도 있다. |
| 응용                          | 사용자가 요청한 기능을 실행한다. 업무 로직을 직접 구현하지 않으며 도메인 계층을 조합해서 기능을 실행 |
| 도메인                        | 시스템이 제공할 **도메인 규칙**을 구현                       |
| 인프라스트럭처                | DB나 메시징 시스템과 같은 외부 시스템과의 연동을 처리한다.   |

- 주문과 관련된 중요 업무 규칙을 주문 도메인 모델인 Order나 OrderState에서 구현해야 한다!
- 핵심 규칙을 구현한 코드는 도메인 모델에만 위치하기 때문에 규칙이 바뀌거나 규칙을 확장해야 할 때 다른 코드에 영향을 덜 주고 변경 내역을 모델에 반영할 수 있게 된다.
- 개념 모델 : 순수하게 문제를 분석한 결과물. db, 트랜잭션 처리, 성능 구현 기술 등을 고려 x
- 처음부터 완벽한 개념 모델을 만들기보다는 전반적인 개요를 알 수 있는 수준으로 개념 모델을 작성해야 한다.

## 1.5 도메인 모델 도출

- 도메인에 대한 이해 없이 코딩을 시작할 수 없다.
- 요구사항(주문)
  - 최소 한 종류 이상의 상품을 주문해야 한다.
  - 출고를 하면 배송지를 변경할 수 없다.
  - 주문할 때 배송지 정보를 반드시 지정해야 한다.
- 이러한 요구사항들을 통해 도메인 모델을 점진적으로 만들어 나가자.

## 1.6 엔티티와 밸류

- 모델은 크게 엔티티와 벨류로 구분할 수 있다.

<img src="/Users/jayo/Library/Application Support/typora-user-images/image-20220612164528110.png" alt="image-20220612164528110" style="zoom:50%;" />

- 이 둘의 차이를 명확하게 이해하는 것은 도메인을 구현하는 데 있어 중요하다.

#### 1.6.1 엔티티

- 엔티티의 가장 큰 특징은 식별자를 가진다는 것.
- 주문의 경우 주문번호가 식별자가 된다.

#### 1.6.2 엔티티의 식별자 생성

- 특정 규칙에 따라 생성
- UUID나 Nano ID와 같은 고유 식별자 생성기 사용
- 값을 직접 입력
- 일련번호 사용(시퀀스나 DB의 Auto Increment 칼럼 사용)

#### 1.6.3 밸류 타입

- 개념적으로 완전한 하나를 표현할 때 사용

- 밸류의 타입은 코드의 의미를 더 잘 이해할 수 있도록 한다.(Money 타입)

- 또한 밸류의 타입을 만들어 데이터 변경 기능을 제공하지 않는 타입. 즉 불변한(immutable) 타입을 만들 수도 있다.

- ~~~java
  this.price = new Money(price.getValue());
  ~~~

#### 1.6.4 엔티티 식별자와 밸류 타입

- 일반적으로 엔티티 식별자의 실제 데이터는 String과 같은 문자열로 구성된 경우가 많다.

- 이러한 식별자가 단순한 문자열이 아니라 도메인에서 특별한 의미를 지니는 경우가 많기 때문에, 식별자를 위한 밸류 타입을 사용해서 의미가 잘 드러나도록 할 수 있다.

  ~~~java
  public class Order {
    private OrderNo id; 
  }
  ~~~

- 필드 이름이 id여도 타입 자체로 주문번호임을 알 수 있다.

#### 1.6.5 도메인 모델에 set 메서드 넣지 않기

- 도메인 모델에 get/set 메서드를 무조건 추가하는 것은 좋지 않은 버릇이다.
- 도메인의 핵심 개념이나 의도를 코드에서 사라지게 할 수 있으며,
- 도메인 객체 생성 시 온전하지 않은 상태가 될 수 있다.
- 도메인 객체가 불완전한 상태로 사용되는 것을 막으려면 생성 시점에 필요한 것을 전달해 주어야 한다.

## 1.7 도메인 용어와 유비쿼터스 언어

- 코드를 작성할 때 도메인에서 사용하는 용어는 매우 중요하다.

- 도메인 용어를 사용해서 구현하는 것이 좋다.

- ~~~java
  public enum OrderState {
    PAYMENT_WAITING, PREPARING, SHIPPED, DELIVERING, DELIVERY_COMPLETED;
  }
  ~~~

- 에릭 에반스는 도메인 주도 설계에서 언어의 중요함을 강조하기 위해 유비쿼터스 언어라는 용어를 사용했다.

- 전문가, 관계자, 개발자가 도메인에 관련된 공통의 언어를 만들고 이를 대화, 문서, 도메인 모델, 코드, 테스트 등 모든 곳에서 같은 용어를 사용하면 소통 과정에서 발생하는 용어의 모호함을 줄일 수 있고, 개발자는 도메인과 코드 사이에서 불필요한 해석 과정을 줄일 수 있다.

- 알맞은 영단어를 찾는 것은 쉽지 않은 일이지만 시간을 들여 찾는 노력을 해야 한다.
